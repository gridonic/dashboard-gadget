<html>
<head>
    <title>Dashboard Gadget: Interface</title>
    <!-- TODO: Add Stylings via bootstrap v3. -->
</head>
<body>
    <h1>Interaktives Dashboard-Gadget: Test-Interface Browser</h1>

    <section>
        <p>Display: 160 x 160px</p>

        <canvas id="display" width="160" height="160" style="width: 160px; height: 160px; border: 5px solid #dd9900;"></canvas>

        <div style="margin-top: 20px;">
            <button id="btn-left">LEFT</button>
            <button id="btn-right">RIGHT</button>
        </div>

        <div style="margin-top: 20px;">
            <input id="input-id" placeholder="12">
            <button id="btn-start">Arduino Login</button>
        </div>

        <div style="margin-top: 20px;">
            <input id="input-username" placeholder="Username" type="text">
            <input id="input-password" placeholder="Password" type="password">
            <button id="btn-create">Benutzer erstellen</button>
        </div>
    </section>

    <script src="/socket.io/socket.io.js"></script>
    <script>

        // todo: auslagern in eigene(s) JAVASCRIPT-FILE(S)

        var socket = io();
        var start = document.getElementById('btn-start');
        var create = document.getElementById('btn-create');
        var canvas = document.getElementById("display");
        var context = canvas.getContext("2d");

        var WAITING_DEFAULT = 0;
        var WAITING_CREATE_USER = 1;
        var actualWaiting = WAITING_DEFAULT;

        var handleError = function (data) {
            console.log('FEHLER!');
            console.log(data);

            switch (actualWaiting) {
                case WAITING_CREATE_USER:
                    console.log('output: ' + data.message);
                    actualWaiting = WAITING_DEFAULT;
                    break;
                default:
                    console.log('no output, not waiting for something.');
            }
        };


        // Todo Sollte nur im Notfall aufgerufen werden, alle default-success sollten direkt adressiert sein.
        var handleSuccess = function (data) {
            console.log('SUCCESS!');
            console.log(data);

            switch (actualWaiting) {
                default:
                    console.log('no output, not waiting for something.');
            }
        };

        // TODO: Adressen hier, die funktionen an sich in externes File auslagern.

        socket.on('show', function (data) {
            console.log(data);

            if (data.draw) {
                context.fillStyle = "#ffffff";
                context.fillRect(0, 0, 160, 160);

                context.fillStyle = "#000000";
                var draw = data.draw.split("");
                var x = 0;
                for (var i = 0; i < 160; i++) {
                    for (var j = 0; j < 160; j++) {
                        if (draw[x] === '1') {
                            context.fillRect(j, i, 1, 1);
                        }
                        x++;
                    }
                }

            }
        });

        socket.on('access', function (data) {
            socket.emit('hello-world', {'message': 'full graphic'});
        });

        socket.on('sendError', function (data) {
            handleError(data);
        });

        socket.on('sendSuccess', function (data) {
            handleSuccess(data);
        });

        socket.on('userCreated', function (data) {
            console.log('user created successfully');
            console.log('output: ' + data.message);
            console.log(data.user);

            // reset waiting
            actualWaiting = WAITING_DEFAULT;
        });

        start.onclick = function () {
            var id = document.getElementById('input-id').value;
            console.log('simulate the "login" with id: ' + id);
            socket.emit('login', {'id': id});
        };

        create.onclick = function () {
            var username = document.getElementById('input-username').value;
            var password = document.getElementById('input-password').value;

            socket.emit('createUser', {'username': username, 'password': password});

            // wait till user is created.
            actualWaiting = WAITING_CREATE_USER;
        }

    </script>

</body>
</html>